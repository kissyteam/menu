modulex.add("menu",["util","component/container","component/extension/delegate-children","node","component/control","component/extension/align","component/extension/shim","component/extension/content-box","xtemplate/runtime"],function(e,t,n){var i,a,r,s,l,o,u,c,d,h,m,g,f,v=e("util"),p=e("component/container"),C=e("component/extension/delegate-children"),b=e("node"),x=e("component/control"),T=e("component/extension/align"),I=e("component/extension/shim"),w=e("component/extension/content-box"),S=e("xtemplate/runtime");i=function(e){function t(e){if(e.target.isMenu){var t=this.el,n=e.newVal;t.setAttribute("aria-activedescendant",n&&n.el.id||"")}}var n=v,i=p,a=C,r=b.Event.KeyCode;return e=i.extend([a],{isMenu:1,beforeCreateDom:function(e){e.elAttrs.role="menu"},bindUI:function(){var e=this;e.on("afterHighlightedItemChange",t,e)},_onSetHighlightedItem:function(e,t){var n;e&&t&&(n=t.prevVal)&&n.set("highlighted",!1,{data:{byPassSetHighlightedItem:1}})},_onSetVisible:function(e,t){var n=this;n.callSuper(e,t);var i;!e&&(i=n.get("highlightedItem"))&&i.set("highlighted",!1)},getRootMenu:function(){return this},handleMouseEnterInternal:function(e){var t=this;t.callSuper(e);var n=t.getRootMenu();n!==t&&n._popupAutoHideTimer&&(clearTimeout(n._popupAutoHideTimer),n._popupAutoHideTimer=null)},handleBlurInternal:function(e){var t=this;t.callSuper(e);var n;(n=t.get("highlightedItem"))&&n.set("highlighted",!1)},_getNextEnabledHighlighted:function(e,t){var n=this.get("children"),i=n.length,a=e;do{var r=n[a];if(!r.get("disabled")&&r.get("visible")!==!1)return n[a];a=(a+t+i)%i}while(a!==e);return void 0},handleKeyDownInternal:function(e){var t=this,i=t.get("highlightedItem");if(i&&i.handleKeyDownInternal(e))return!0;var a=t.get("children"),s=a.length;if(0===s)return void 0;var l,o,u;switch(e.keyCode){case r.ESC:(i=t.get("highlightedItem"))&&i.set("highlighted",!1);break;case r.HOME:u=t._getNextEnabledHighlighted(0,1);break;case r.END:u=t._getNextEnabledHighlighted(s-1,-1);break;case r.UP:i?(l=n.indexOf(i,a),o=(l-1+s)%s):o=s-1,u=t._getNextEnabledHighlighted(o,-1);break;case r.DOWN:i?(l=n.indexOf(i,a),o=(l+1+s)%s):o=0,u=t._getNextEnabledHighlighted(o,1)}return u?(u.set("highlighted",!0,{data:{fromKeyboard:1}}),!0):void 0},containsElement:function(e){var t=this,n=t.$el;if(!t.get("visible")||!n)return!1;if(n&&(n[0]===e||n.contains(e)))return!0;for(var i=t.get("children"),a=0,r=i.length;r>a;a++){var s=i[a];if(s.containsElement&&s.containsElement(e))return!0}return!1}},{ATTRS:{handleGestureEvents:{value:!0},focusable:{value:!0},allowTextSelection:{value:!1},highlightedItem:{value:null},defaultChildCfg:{valueFn:function(){return{xclass:"menuitem"}}}},xclass:"menu"})}(),a=function(e){var t=x,n=b;return e=t.extend({isMenuItem:1,beforeCreateDom:function(e){e.elAttrs.role="menuitem"},handleClickInternal:function(e){var t=this;return t.callSuper(e),e.preventDefault(),t.fire("click"),!0},_onSetHighlighted:function(e,t){var i=this,a=i.get("parent");if(i.callSuper(e,t),t&&t.byPassSetHighlightedItem||(i.get("rendered")?a.set("highlightedItem",e?i:null):e&&a.set("highlightedItem",i)),e){var r=i.$el,s=r.parent(function(e){return"visible"!==n(e).css("overflow")},a.get("el").parent());if(!s)return;r.scrollIntoView(s,{alignWithTop:!0,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})}},containsElement:function(e){var t=this.$el;return t&&(t[0]===e||t.contains(e))}},{ATTRS:{handleGestureEvents:{value:!1},focusable:{value:!1},allowTextSelection:{value:!1}},xclass:"menuitem"})}(),r=function(e){var t=e=function(e){{var t,n=this,i=n.root,a=n.buffer,r=n.scope,s=(n.runtime,n.name,n.pos),l=r.data,o=r.affix,u=i.nativeCommands,c=i.utils,d=c.callFn;c.callCommand,u.range,u.foreach,u.forin,u.each,u["with"],u["if"],u.set,u.include,u.parse,u.extend,u.block,u.macro,u["debugger"]}a.data+='<div class="';var h;h=d(n,r,{escape:1,params:["checkbox"]},a,["getBaseCssClasses"]),a=a.writeEscaped(h),a.data+='">\r\n</div>\r\n<div class="',s.line=3;var m;m=d(n,r,{escape:1,params:["content"]},a,["getBaseCssClasses"]),a=a.writeEscaped(m),a.data+='">';var g=(t=o.content)!==e?t:(t=l.content)!==e?t:r.resolveLooseUp(["content"]);return a=a.write(g),a.data+="</div>",a};return t.TPL_NAME=n.id||n.name,e}(),s=function(e){var t=e=function(e){{var t,n=this,i=n.root,a=n.buffer,r=n.scope,s=(n.runtime,n.name,n.pos),l=r.data,o=r.affix,u=i.nativeCommands,c=i.utils,d=c.callFn;c.callCommand,u.range,u.foreach,u.forin,u.each,u["with"],u["if"],u.set,u.include,u.parse,u.extend,u.block,u.macro,u["debugger"]}a.data+='<div class="',s.line=1;var h;h=d(n,r,{escape:1,params:["radio"]},a,["getBaseCssClasses"]),a=a.writeEscaped(h),a.data+='">\r\n</div>\r\n<div class="',s.line=3;var m;m=d(n,r,{escape:1,params:["content"]},a,["getBaseCssClasses"]),a=a.writeEscaped(m),a.data+='">';var g=(t=o.content)!==e?t:(t=l.content)!==e?t:r.resolveLooseUp(["content"]);return a=a.write(g),a.data+="</div>",a};return t.TPL_NAME=n.id||n.name,e}(),l=function(e){var t=e=function(e){{var t,n=this,i=n.root,a=n.buffer,r=n.scope,s=(n.runtime,n.name,n.pos),l=r.data,o=r.affix,u=i.nativeCommands,c=i.utils,d=c.callFn;c.callCommand,u.range,u.foreach,u.forin,u.each,u["with"],u["if"],u.set,u.include,u.parse,u.extend,u.block,u.macro,u["debugger"]}a.data+='<div class="',s.line=1;var h;h=d(n,r,{escape:1,params:["content"]},a,["getBaseCssClasses"]),a=a.writeEscaped(h),a.data+='">';var m=(t=o.content)!==e?t:(t=l.content)!==e?t:r.resolveLooseUp(["content"]);a=a.write(m),a.data+='</div>\r\n<span class="',s.line=2;var g=(t=o.prefixCls)!==e?t:(t=l.prefixCls)!==e?t:r.resolveLooseUp(["prefixCls"]);return a=a.writeEscaped(g),a.data+='submenu-arrow">â–º</span>',a};return t.TPL_NAME=n.id||n.name,e}(),o=function(e){var t=T,n=I,a=i,r=w;return e=a.extend([r,n,t],{getRootMenu:function(){var e,t=this,n=t;do e=n,n=n.get("parent");while(n&&(n.isMenuItem||n.isMenu));return e},handleMouseLeaveInternal:function(e){var t=this;if(t.callSuper(e),t.get("autoHideOnMouseLeave")){var n=t.getRootMenu();n!==this&&(clearTimeout(n._popupAutoHideTimer),n._popupAutoHideTimer=setTimeout(function(){var e;(e=n.get("highlightedItem"))&&e.set("highlighted",!1)},1e3*t.get("parent").get("menuDelay")))}},isPopupMenu:1,handleBlurInternal:function(e){var t=this;t.callSuper(e),t.hide()}},{ATTRS:{handleGestureEvents:{value:!0},focusable:{value:!1},allowTextSelection:{value:!1},autoHideOnMouseLeave:{},visible:{value:!1}},xclass:"popupmenu"})}(),u=function(e){var t=r,n=S,i=new n(t);return e=function(){return i.render.apply(i,arguments)}}(),c=function(e){var t=s,n=S,i=new n(t);return e=function(){return i.render.apply(i,arguments)}}(),d=function(e){var t=l,n=S,i=new n(t);return e=function(){return i.render.apply(i,arguments)}}(),h=function(e){var t=a,n=w,i=u;return e=t.extend([n],{beforeCreateDom:function(e){e.checked&&e.elCls.push(this.getBaseCssClasses("checked"))},_onSetChecked:function(e){var t=this,n=t.getBaseCssClasses("checked");t.$el[e?"addClass":"removeClass"](n)},handleClickInternal:function(e){var t=this;return t.set("checked",!t.get("checked")),t.callSuper(e),!0}},{ATTRS:{contentTpl:{value:i},checked:{render:1,sync:0}},xclass:"check-menuitem"})}(),m=function(e){var t=a,n=w,i=c;return e=t.extend([n],{beforeCreateDom:function(e){e.elAttrs.role="menuitemradio",e.selected&&e.elCls.push(this.getBaseCssClasses("selected"))},_onSetSelected:function(e){var t=this,n=t.getBaseCssClasses("selected");t.$el[e?"addClass":"removeClass"](n)},handleClickInternal:function(e){var t=this,n=t.get("parent").getRootMenu(),i=n.__selectedItem;return i&&i!==t&&i.set("selected",!1),n.__selectedItem=t,t.set("selected",!0),t.callSuper(e),!0},destructor:function(){var e=this.get("parent"),t=e&&e.getRootMenu();t&&t.__selectedItem===this&&(t.__selectedItem=null)}},{ATTRS:{contentTpl:{value:i},selected:{sync:0,render:1}},xclass:"radio-menuitem"})}(),g=function(e){function t(e){var t=e.target,n=this;t!==n&&t.isMenuItem&&e.newVal&&(n.clearHidePopupMenuTimers(),n.get("highlighted")||(n.set("highlighted",!0),t.set("highlighted",!1),t.set("highlighted",!0)))}function n(){var e=this,t=e.get("menu"),n={node:this.$el,points:["tr","tl"],overflow:{adjustX:1,adjustY:1}};r.mix(t.get("align"),n,!1),t.show(),e.el.setAttribute("aria-haspopup",t.get("el").attr("id"))}function i(){this.get("menu").hide()}var r=v,s=d,l=a,o=w,u=b.Event.KeyCode,c=.15;return e=l.extend([o],{isSubMenu:1,decorateDom:function(e){var t=this,n=t.get("prefixCls"),i=e.one("."+n+"popupmenu"),a=i[0].ownerDocument.body;a.insertBefore(i[0],a.firstChild);var r=t.getComponentConstructorByNode(n,i);t.setInternal("menu",new r({srcNode:i,prefixCls:n}))},bindUI:function(){var e=this;e.on("afterHighlightedChange",t,e)},clearShowPopupMenuTimers:function(){var e;(e=this._showTimer)&&(e.cancel(),this._showTimer=null)},clearHidePopupMenuTimers:function(){var e;(e=this._dismissTimer)&&(e.cancel(),this._dismissTimer=null)},clearSubMenuTimers:function(){this.clearHidePopupMenuTimers(),this.clearShowPopupMenuTimers()},handleMouseLeaveInternal:function(){var e=this;e.set("highlighted",!1,{data:{fromMouse:1}}),e.clearSubMenuTimers();var t=e.get("menu");t.get("visible")&&(e._dismissTimer=r.later(i,1e3*e.get("menuDelay"),!1,e))},handleMouseEnterInternal:function(){var e=this;e.set("highlighted",!0,{data:{fromMouse:1}}),e.clearSubMenuTimers();var t=e.get("menu");t.get("visible")||(e._showTimer=r.later(n,1e3*e.get("menuDelay"),!1,e))},_onSetHighlighted:function(e,t){var a=this;a.callSuper(e,t),t&&(t.fromMouse||(e&&!t.fromKeyboard?n.call(a):e||i.call(a)))},handleClickInternal:function(e){n.call(this),this.callSuper(e)},handleKeyDownInternal:function(e){var t,i,a=this,r=a.get("menu"),s=r.get("visible"),l=e.keyCode;if(s){if(!r.handleKeyDownInternal(e)){if(l!==u.LEFT)return void 0;a.set("highlighted",!1),a.set("highlighted",!0,{data:{fromKeyboard:1}})}}else{if(l!==u.RIGHT)return l===u.ENTER?a.handleClickInternal(e):void 0;n.call(a),t=r.get("children"),(i=t[0])&&i.set("highlighted",!0,{data:{fromKeyboard:1}})}return!0},containsElement:function(e){return this.get("menu").containsElement(e)},destructor:function(){var e=this,t=e.get("menu");e.clearSubMenuTimers(),t.destroy()}},{ATTRS:{contentTpl:{value:s},menuDelay:{value:c},menu:{getter:function(e){return e=e||{},e.isControl||(e.xclass=e.xclass||"popupmenu",e=this.createComponent(e),this.setInternal("menu",e)),e},setter:function(e){e.isControl&&e.setInternal("parent",this)}}},xclass:"submenu"})}(),f=function(e){var t=i;return t.Item=a,t.CheckItem=h,t.RadioItem=m,t.SubMenu=g,t.PopupMenu=o,e=t,t.version="1.0.1",e}(),n.exports=f});